@model GrapheneTrace_GP.Areas.Admin.ViewModels.DashboardVM

@{
    Layout = "~/Areas/Admin/Views/Shared/_DashboardLayout.cshtml";
    ViewData["Title"] = "Dashboard";
}
<div class="dashboard-container">

    <div class="stats-row">

        <div class="stat-card small">
            <div class="stat-icon bg-blue"><i class="fas fa-user-md"></i></div>
            <h2>@Model.ActiveClinicians</h2>
            <p>Active Clinician</p>
        </div>

        <div class="stat-card small">
            <div class="stat-icon bg-green"><i class="fas fa-users"></i></div>
            <h2>@Model.ActivePatients</h2>
            <p>Active Patients</p>
        </div>

        <div class="stat-card small">
            <div class="stat-icon bg-purple"><i class="fas fa-calendar-check"></i></div>
            <h2>@Model.NextDayAppointments</h2>
            <p>Next Day Appointments</p>
        </div>

        <!-- Donut chart of total patients -->
        <div class="donut-card">
            <h3>Total Patients</h3>
            <canvas id="donutChart"></canvas>
        </div>

    </div>


    <!-- bottom row starts here -->
    <div class="bottom-row">

        <!-- Line chart -->
        <div class="chart-panel wide">
            <h3>Patients</h3>
            <canvas id="patientChart"></canvas>
        </div>


        <!-- Appointment booking -->

        <div class="appointment-panel">
            <h3>Appointment Booking</h3>
            <div id="appointment-calendar"></div>
        </div>

</div> <!--dashboard container ends here-->
    <!--Appointment table-->
    <div class="appointments-panel">
        <h3>Upcoming Appointments</h3>

        <div class="appointments-table-wrapper">

            <table class="appointments-table">
                <thead>
                    <tr>
                        <th style="width:60px">S.no</th>
                        <th style="width:70px">Title</th>
                        <th style="width:200px">Patient Name</th>
                        <th style="width:120px">Patient ID</th>
                        <th style="width:160px">Doctor Name</th>
                        <th style="width:60px">Age</th>
                        <th style="width:120px">Status</th>
                    </tr>
                </thead>

                <tbody>
                    @foreach (var item in Model.UpcomingAppointments)
                    {
                        <tr>
                            <td>@item.sno</td>
                            <td>@item.Title</td>
                            <td>@item.PatientName</td>
                            <td>@item.PatientId</td>
                            <td>@item.ClinicianName</td>
                            <td>@item.Age</td>
                            <td>
                                <span class="status-badge @(item.Status.ToLower() == "active" ? "badge-active" : "badge-inactive")">
                                    @item.Status
                                </span>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

        </div> <!--Appointment table ends here-->

    </div>

</div>


@section Scripts {

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    <script src="~/js/dashboard-charts.js"></script>
    <script src="~/js/appointment-calendar.js"></script>

    <script>

        // Initialize Patient Line Chart
        const patientCtx = document.getElementById('patientChart').getContext('2d');
        const patientChart = new Chart(patientCtx, {
            type: 'line',
            data: {
                labels: @Html.Raw(Json.Serialize(Model.MonthLabels)),
                datasets: [
                    {
                    label: 'New Patients',
                    data: @Html.Raw(Json.Serialize(Model.MonthlyNewPatients)),
                    borderColor: 'rgba(75, 192, 192, 1)',
                    fill: false,
                    tension: 0.1
                    }
                ]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }

        });

        // Initialize Total Patients Donut Chart
        const donutCtx = document.getElementById('donutChart').getContext('2d');
            const donutChart = new Chart(donutCtx, {
             type: 'doughnut',
              data: {
                 labels: ['Active', 'Inactive'],
                 datasets: [
            {
                label: 'Total Patients',
                       data: [@Model.TotalActivePatients, @Model.TotalInactivePatients],
                       backgroundColor: 
                       [
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 99, 132, 0.7)'
                       ],
                hoverOffset: 4
            }
                           ]
        },
        options: {
            responsive: true
        }
        });

        // Initialize FullCalendar for Appointment Booking
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('appointment-calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                height: 400,
                events: [
                    { title: 'Appointment with John Doe', start: '2024-07-10T10:00:00' },
                    { title: 'Appointment with Jane Smith', start: '2024-07-12T14:00:00' },
                    { title: 'Appointment with Bob Johnson', start: '2024-07-15T09:00:00' }
                ]
            });
            calendar.render();
        });
    </script>
}