@using GrapheneTrace_GP.Services
@model GrapheneTrace_GP.Areas.Admin.ViewModels.PatientDetailsVM
@{
    // Flatten heatmap into a single list
    var allValues = Model.Heatmap.SelectMany(r => r);

    // Compute min & max
    float minValue = allValues.Min();
    float maxValue = allValues.Max();
}

<style>
    .equal-card {
        height: 100%;
        display: flex;
        flex-direction: column;
    }

        .equal-card .card-body {
            flex-grow: 1;
        }

    .heatmap-box {
        width: 100%;
        height: 320px; /* lock height */
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
    }

    .heatmap-table {
        border-collapse: collapse;
    }

    .heatmap-cell {
        width: 8px;
        height: 8px;
        padding: 0;
    }
</style>


<div class="container-fluid mt-4">

    <h2 class="fw-bold mb-4">Patients Data > @Model.Patient.FirstName @Model.Patient.LastName</h2>

    <div class="row g-4">

        <div class="row g-4 mt-3">

            <!-- LEFT CARD -->
            <div class="col-md-4">
                <div class="card equal-card shadow-sm">
                    <div class="card-body">
                        <h4 class="text-primary">@Model.Patient.FirstName @Model.Patient.LastName</h4>
                        <p class="text-muted">@Model.Patient.Email</p>

                        <p class="fw-bold">Patient ID</p>
                        <p>@Model.Patient.PatientId</p>

                        <span class="badge
                        @(Model.Patient.Status == "Active" ? "bg-success" :
                                                        Model.Patient.Status == "Alert" ? "bg-danger" : "bg-secondary")">
                            @Model.Patient.Status
                        </span>

                        <button class="btn btn-outline-primary w-100 mt-3">
                            Send Message
                        </button>
                    </div>
                </div>
            </div>

            <!-- MIDDLE CARD -->
            <div class="col-md-4">
                <div class="card equal-card shadow-sm">
                    <div class="card-body">
                        <p><strong>Gender:</strong> @Model.Patient.Gender</p>
                        <p><strong>Date Of Birth:</strong> @Model.Patient.DateOfBirth</p>
                        <p><strong>City:</strong> @Model.Patient.City</p>
                        <p><strong>Phone No:</strong> @Model.Patient.Phone</p>
                        <p><strong>Address:</strong> @Model.Patient.Address</p>
                        <p><strong>Postal Code:</strong> @Model.Patient.PostCode</p>
                    </div>
                </div>
            </div>

            <!-- RIGHT HEATMAP CARD -->
            <div class="col-md-4">
                <div class="card equal-card shadow-sm">
                    <div class="card-body">
                        <h5 class="fw-bold mb-3">Pressure Data</h5>

                        <div class="heatmap-box">
                            <table class="heatmap-table">
                                @foreach (var row in Model.Heatmap)
                                {
                                    <tr>
                                        @foreach (var cell in row)
                                        {
                                            <td class="heatmap-cell"
                                                style="background:@ColorMaps.GetInfernoColor(cell, minValue, maxValue)">
                                            </td>
                                        }
                                    </tr>
                                }
                            </table>
                        </div>

                    </div>
                </div>
            </div>

        </div>


    </div>
</div>




